<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liste des Animes</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <style>
    ::-webkit-scrollbar {
      width: 0px; /* Masque la barre de défilement verticale */
      height: 0px; /* Masque la barre de défilement horizontale */
    }

    /* Réinitialisation des styles de base */
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #09090b;
      padding: 20px;
      font-size: 16px;
      color: #ffffff;
      overflow: -moz-scrollbars-none; /* Supprime les barres de défilement dans les anciens Firefox */
      -ms-overflow-style: none;  /* Pour Internet Explorer et Edge */
    }

    .titre {
      font-size: 40px;
      text-align: center;
      margin-bottom: 80px;
    }

    .buttons-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 20px;
      position: relative;
    }

    .day-button {
      padding: 20px 40px;
      border: none;
      border-radius: 5px;
      background-color: rgb(218, 52, 52);
      color: white;
      font-size: 40px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .day-button:hover {
      background-color: rgba(218, 52, 52, 0.4);
    }

    .anime-container {
      display: grid;
      grid-template-columns: repeat(6, 1fr); /* 6 colonnes */
      gap: 0; /* Réduire l'espace entre les cartes */
      grid-auto-flow: dense;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .anime-card {
      height: 1fr;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0px 5px 15px rgba(24, 24, 27, 0.5);
      background-color: #18181b;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      max-width: 300px; /* Réduire la largeur maximale de chaque carte */
      margin: 50px;
    }
    
    .anime-card.show {
      opacity: 1;
      transform: translateY(0);
    }

    .anime-card.hidden {
      display: none;
    }

    .anime-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .anime-details {
      margin: auto;
      padding: 20px;
      width: 80%;
    }

    .anime-title {
      font-size: 32px;
      font-weight: bold;
    }

    .anime-date {
      color: #888;
      margin-top: 10px;
      font-size: 28px;
    }

    .anime-link {
      display: block;
      margin-top: 20px;
      color: rgb(218, 52, 52);
      text-decoration: none;
      font-weight: bold;
      font-size: 28px;
    }

    .anime-link:hover {
      text-decoration: underline;
    }

    .anime-lang {
      color: #c5c5c5;
      font-size: 28px;
      text-transform: uppercase;
      margin: 10px 0;
      font-weight: bold;
    }

    .day-button.active {
      background-color: rgba(218, 52, 52, 0.4);
    }

  </style>
</head>

<body>
  <div class="titre">
      <h1>Liste des Animes</h1>
  </div>
  <div>
    <div class="buttons-container" id="buttonsContainer"></div>
  </div>
  <div>
    <div class="anime-container" id="animeContainer"></div>
    <div>
      <script>
        const apiUrl = 'https://api.franime.fr/api/calendrier_data'; // URL de l'API

        // Fonction pour afficher les animes triés par jour de la semaine
        async function fetchAnimes() {
          try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.success && Array.isArray(data.data)) {
              const buttonsContainer = document.getElementById('buttonsContainer');
              const animeContainer = document.getElementById('animeContainer');
              animeContainer.innerHTML = ''; // Effacer les anciens résultats

              // Boutton pour chaques jours de la semaine
              const daysOfWeek = ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi', 'dimanche'];
              daysOfWeek.forEach(day => {
                const button = document.createElement('button');
                button.classList.add('day-button');
                button.textContent = capitalizeFirstLetter(day);
                button.addEventListener('click', () => {
                  // Supprimer la classe active de tous les boutons
                  const buttons = document.querySelectorAll('.day-button');
                  buttons.forEach(btn => btn.classList.remove('active'));
                  // Ajouter la classe active au bouton cliqué
                  button.classList.add('active');
                  displayAnimesByDay(day);
                });
                buttonsContainer.appendChild(button);
              });

              // Organiser les animes par jour
              const animeByDay = {};
              daysOfWeek.forEach(day => {
                animeByDay[day] = [];
              });

              data.data.forEach(anime => {
                if (animeByDay[anime.jour]) {
                  animeByDay[anime.jour].push(anime);
                }
              });

              // Trier les animes par heure et minute pour chaque jour
              Object.keys(animeByDay).forEach(day => {
                animeByDay[day].sort((a, b) => {
                  const timeA = parseInt(a.heures) * 60 + parseInt(a.minutes);
                  const timeB = parseInt(b.heures) * 60 + parseInt(b.minutes);
                  return timeA - timeB;
                });

                // Classer pour chaque jours
                animeByDay[day].forEach(anime => {
                  createAnimeCard(anime, animeContainer, day);
                });
              });

              // Utiliser le jour acctuel comme base
              const today = getTodayDay();
              displayAnimesByDay(today);

            } else {
              console.error('Structure inattendue des données de l\'API');
            }

          } catch (error) {
            console.error('Erreur lors du chargement des animes :', error);
          }
        }

        // Fonction pour creer une carte avec l'api
        function createAnimeCard(anime, container, day) {
          const animeCard = document.createElement('div');
          animeCard.classList.add('anime-card');
          animeCard.dataset.day = day;

          // Image d'affiche
          const img = document.createElement('img');
          img.src = anime.affiche;
          animeCard.appendChild(img);

          // Infos de l'anime
          const animeDetails = document.createElement('div');
          animeDetails.classList.add('anime-details');

          // Titre de l'anime
          const title = document.createElement('div');
          title.classList.add('anime-title');
          title.textContent = anime.title_anime;
          animeDetails.appendChild(title);

          // Titre
          const lang = document.createElement('div');
          lang.classList.add('anime-lang');
          lang.textContent = anime.lang.toUpperCase();
          animeDetails.appendChild(lang);

          // Heure de sortie
          const date = document.createElement('div');
          date.classList.add('anime-date');
          date.textContent = `Heure: ${anime.heures}h${anime.minutes}`;
          animeDetails.appendChild(date);

          // URL
          const link = document.createElement('a');
          link.href = anime.url_access_anime_page;
          link.classList.add('anime-link');
          link.textContent = 'Voir plus';
          animeDetails.appendChild(link);

          animeCard.appendChild(animeDetails);
          container.appendChild(animeCard);
        }

        // Trier les cartes par jours
        function displayAnimesByDay(day) {
          const cards = document.querySelectorAll('.anime-card');
          const container = document.querySelector('.anime-container');

          cards.forEach(card => {
            card.classList.add('hidden');
            card.classList.remove('show');
          });

          // Delai sur L'affichage des cartes
          let delay = 0;
          cards.forEach((card, index) => {
            if (card.dataset.day === day) {
              card.classList.remove('hidden');
              setTimeout(() => card.classList.add('show'), delay);
              delay += 100; // + 0.1s animation
            }
          });
        }

        // Fonction jours de la semaine
        function getTodayDay() {
          const daysOfWeek = ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi', 'dimanche'];
          const today = new Date().getDay();
          return daysOfWeek[(today + 6) % 7]; // Debut Lundi
        }

        // Fonction pour capitaliser la première lettre d'un mot
        function capitalizeFirstLetter(string) {
          return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Appeler la fonction pour récupérer les animes au chargement de la page
        fetchAnimes();
      </script>
    </div>
  </div>

</body>

</html>